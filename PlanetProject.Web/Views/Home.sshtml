<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Planet Project</title>
    <link rel="stylesheet" href="Content/bootstrap.min.css" />
    <link rel="stylesheet" href="Content/site.css" />
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-4">
        <div id="planetList" class="list-group">
        </div>
      </div>
      <div class="col-md-8">
        <table id="planetInfo" class="table table-bordered">
          <tbody>
            <tr>
              <td class="info-label">Name</td>
              <td>Earth</td>
            </tr>
            <tr>
              <td class="info-label">Mass</td>
              <td>1</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <script src="Scripts/jquery-1.9.1.min.js"></script>
  <script src="Scripts/bootstrap.min.js"></script>
  <script src="Scripts/bundle.js"></script>
  <script>
    function addPlanetItem(planet) {
      var element = $('<a />')
        .attr('href', '#')
        .attr('class', 'planet-item list-group-item')
        .attr('onclick', 'showInfoForPlanet(\'' + planet.name + '\')')
        .text(planet.name);
      $('#planetList').append(element);
    }

    function showInfoForPlanet(planetName) {
      $.ajax({
        method: 'GET',
        url: '/api/planets/' + planetName.toLowerCase(),
        success: function(data) {
          console.log(data);
          populateInfoTable(data);
        }
      });
    }

    function populateInfoTable(planet) {
      $('#planetInfo tr').remove();
      for (var prop in planet) {
        if (planet.hasOwnProperty(prop)) {
          addRowToInfoTable(titleize(prop), planet[prop]);
        }
      }
    }

    function addRowToInfoTable(label, value) {
      var element = $('<tr />');
      var labelElement = $('<td />')
        .attr('class', 'info-label')
        .text(label);
      var valueElement = $('<td />')
        .text(value);
      element.append(labelElement);
      element.append(valueElement);
      $('#planetInfo tbody').append(element);
    }

    function titleize(text) {
      return text
        .replace(/([A-Z])/g, function(match) {
           return " " + match;
        })
        .replace(/^./, function(match) {
          return match.toUpperCase();
        });
    }

    function init() {
      $.ajax({
        method: 'GET',
        url: '/api/planets',
        success: function(data) {
          data.map(function(planet) {
            addPlanetItem(planet);
          });
        }
      });
    }

    $(document).ready(function() {
      init();
    });
  </script>
</body>
</html>
